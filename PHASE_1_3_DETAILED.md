# Phase 1.3 - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)

## üìã –û–±–∑–æ—Ä Phase 1.3

**–¶–µ–ª—å**: –†–∞—Å—à–∏—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–≤—É—Ö —Ä–æ–ª–µ–π Trader –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ClickHouse.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

**–§–∞–π–ª—ã**:
- `internal/config/config.go` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `conf/config.example.yaml` - –ø—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –î–≤–æ–π—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Ä–æ–ª–µ–π

Trader —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ–¥–Ω–æ–π –∏–∑ —Ç—Ä–µ—Ö —Ä–æ–ª–µ–π:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ trader (–µ–¥–∏–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                              ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ MONITOR Role   ‚îÇ           ‚îÇ TRADER Role      ‚îÇ
     ‚îÇ                ‚îÇ           ‚îÇ                  ‚îÇ
     ‚îÇ - –°–ª—É—à–∞–µ—Ç WS   ‚îÇ           ‚îÇ - –í—ã–ø–æ–ª–Ω—è–µ—Ç      ‚îÇ
     ‚îÇ - –°–æ–±–∏—Ä–∞–µ—Ç OB  ‚îÇ           ‚îÇ   —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏      ‚îÇ
     ‚îÇ - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤  ‚îÇ           ‚îÇ - –ò—Å–ø–æ–ª–Ω—è–µ—Ç      ‚îÇ
     ‚îÇ   ClickHouse   ‚îÇ           ‚îÇ   –æ—Ä–¥–µ—Ä–∞         ‚îÇ
     ‚îÇ - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞    ‚îÇ           ‚îÇ - –†–∏—Å–∫ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –û–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–æ–º –∏ —Ç—Ä–µ–π–¥–µ—Ä–æ–º
- –ú–æ–Ω–∏—Ç–æ—Ä –∏ –¢—Ä–µ–π–¥–µ—Ä –º–æ–≥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –º–æ–∂–Ω–æ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤ –∏ –æ–¥–∏–Ω —Ç—Ä–µ–π–¥–µ—Ä
- –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å: –ª–µ–≥–∫–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –Ω–µ–ø–æ—Ç—Ä–µ–±–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

---

## üîß –ù–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ Config

### 1. –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Config (–∏–∑–º–µ–Ω–µ–Ω–∏—è)

```go
type Config struct {
    Database   DatabaseConfig      // –ë—ã–ª–æ —Ä–∞–Ω—å—à–µ
    Server     ServerConfig        // –ë—ã–ª–æ —Ä–∞–Ω—å—à–µ
    Log        LogConfig           // –ë—ã–ª–æ —Ä–∞–Ω—å—à–µ
    Trade      TradeConfig         // –ë—ã–ª–æ —Ä–∞–Ω—å—à–µ
    OrderBook  OrderBookConfig     // –ë—ã–ª–æ —Ä–∞–Ω—å—à–µ
    
    // –ù–û–í–û–ï –≤ Phase 1.3:
    Role       string              // "monitor", "trader" –∏–ª–∏ "both"
    Monitor    MonitorConfig       // –ö–æ–Ω—Ñ–∏–≥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    Trader     TraderConfig        // –ö–æ–Ω—Ñ–∏–≥ —Ç–æ—Ä–≥–æ–≤–ª–∏
    ClickHouse ClickHouseConfig    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse
}
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è**:
- `Role` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–∏—Å—É (–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å, —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –∏–ª–∏ –æ–±–∞)
- `Monitor` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–≥–ª—É–±–∏–Ω–∞ OB, batch size –∏ —Ç.–¥.)
- `Trader` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ (max orders, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, —Ä–∏—Å–∫)
- `ClickHouse` - –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

### 2. MonitorConfig - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```go
type MonitorConfig struct {
    // –ö–∞–∫—É—é –≥–ª—É–±–∏–Ω—É –∫–Ω–∏–≥–∏ –æ—Ä–¥–µ—Ä–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
    OrderBookDepth int  // 20, 50 –∏–ª–∏ 0 (full)
    
    // –ö–∞–∫ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –≤ batch –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ ClickHouse
    BatchSize      int  // –°–∫–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ batch (500-1000)
    BatchIntervalSec int // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ (5-10s)
    
    // –ö—ç—à –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–∏–º –¥–∞–Ω–Ω—ã–º
    RingBufferSize int  // –†–∞–∑–º–µ—Ä ring buffer (10000-50000)
    
    // –ö–∞–∫ —á–∞—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ
    SaveInterval   int  // –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (5-10s)
}
```

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:

```yaml
# –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–º–µ–Ω—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∏, –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏)
monitor:
    orderbook_depth: 50      # –ì–ª—É–±–æ–∫–∞—è –∫–Ω–∏–≥–∞
    batch_size: 1000         # –ë–æ–ª—å—à–æ–π batch
    batch_interval: 2        # –ß–∞—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
    ring_buffer_size: 50000  # –ë–æ–ª—å—à–æ–π –∫—ç—à
    save_interval: 2

# –î–ª—è —ç–∫–æ–Ω–æ–º–Ω–æ–≥–æ —Å–±–æ—Ä–∞ (–º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏, –±–æ–ª—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∞)
monitor:
    orderbook_depth: 20      # –ú–µ–ª–∫–∞—è –∫–Ω–∏–≥–∞
    batch_size: 100          # –ú–∞–ª–µ–Ω—å–∫–∏–π batch
    batch_interval: 10       # –†–µ–¥–∫–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
    ring_buffer_size: 1000   # –ú–∞–ª–µ–Ω—å–∫–∏–π –∫—ç—à
    save_interval: 10
```

**–ê–ª–≥–æ—Ä–∏—Ç–º —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**:

```
1. Monitor –ø–æ–ª—É—á–∞–µ—Ç OrderBook update –æ—Ç –±–∏—Ä–∂–∏
2. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ standardized Message —Ñ–æ—Ä–º–∞—Ç
3. –î–æ–±–∞–≤–ª—è–µ—Ç –≤ ring buffer (–±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø)
4. –î–æ–±–∞–≤–ª—è–µ—Ç –≤ batch –¥–ª—è ClickHouse
5. –ï—Å–ª–∏ batch –ø–æ–ª–Ω—ã–π –ò–õ–ò –ø—Ä–æ—à–ª–æ BatchIntervalSec —Å–µ–∫—É–Ω–¥:
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç batch –≤ ClickHouse
   - –û—á–∏—â–∞–µ—Ç batch
6. –ö–∞–∂–¥—ã–µ SaveInterval —Å–µ–∫—É–Ω–¥ - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
```

### 3. TraderConfig - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏

```go
type TraderConfig struct {
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ä–¥–µ—Ä–æ–≤
    MaxOpenOrders  int     // –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
    
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (—Ä–∏—Å–∫ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç)
    MaxPositionSize float64 // –ú–∞–∫—Å–∏–º—É–º –≤ USDT –Ω–∞ –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é
    
    // –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    DefaultStrategy string  // "grid", "dca", "scalp" –∏ —Ç.–¥.
    StrategyUpdateInterval int // –ö–∞–∫ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
    
    // –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
    SlippagePercent float64 // –î–æ–ø—É—Å—Ç–∏–º–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (%)
    
    // –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    EnableBacktest bool     // true = —Å–∏–º—É–ª—è—Ü–∏—è, false = —Ä–µ–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
}
```

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:

```yaml
# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è (–º–∞–ª–æ –æ—Ä–¥–µ—Ä–æ–≤, –º–∞–ª—ã–π —Ä–∏—Å–∫)
trader:
    max_open_orders: 5
    max_position_size: 500.0
    default_strategy: dca           # Dollar Cost Averaging (–Ω–∞–¥–µ–∂–Ω–∞—è)
    strategy_update_interval: 30    # –†–µ–¥–∫–æ –æ–±–Ω–æ–≤–ª—è–µ–º
    slippage_percent: 0.1           # –°—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
    enable_backtest: true           # –°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º!

# –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è (–º–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–æ–≤, –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)
trader:
    max_open_orders: 20
    max_position_size: 5000.0
    default_strategy: grid          # Grid Trading (–≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–∞—è)
    strategy_update_interval: 5     # –ß–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º
    slippage_percent: 1.0           # –ú—è–≥—á–µ –∫ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—é
    enable_backtest: false          # –£–∂–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏
```

**–†–∏—Å–∫ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç**:

```
–ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ 5 –æ—Ä–¥–µ—Ä–æ–≤ –∏–∑ 5 –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö:
  ‚îî‚îÄ –ù–æ–≤—ã–µ –æ—Ä–¥–µ—Ä–∞ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∞)

–ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è BTC = 1500$ –∏–∑ –º–∞–∫—Å–∏–º—É–º–∞ 5000$:
  ‚îî‚îÄ –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –µ—â–µ 3500$ –ø–æ–∑–∏—Ü–∏–∏ (—Å–ª–µ–¥–∏—Ç –∑–∞ –ª–∏–º–∏—Ç–æ–º)

–ï—Å–ª–∏ –æ—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–∏–ª—Å—è —Ö—É–∂–µ —á–µ–º –Ω–∞ 1% (SlippagePercent):
  ‚îî‚îÄ –ü–æ–∑–∏—Ü–∏—è –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –æ—Ä–¥–µ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –∏ –ø–µ—Ä–µ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è
```

### 4. ClickHouseConfig - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse

```go
type ClickHouseConfig struct {
    // –ê–¥—Ä–µ—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    Host     string  // –•–æ—Å—Ç ClickHouse (–æ–±—ã—á–Ω–æ –∫–∞–∫–æ–π-—Ç–æ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
    Port     int     // –ü–æ—Ä—Ç HTTP API (8123)
    Database string  // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse
    
    // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    Username string
    Password string
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    UseTLS       bool  // HTTPS –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    TLSSkipVerify bool // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
    
    // –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
    ConnectTimeoutSec int // –¢–∞–π–º–∞—É—Ç (10s)
    MaxRetries        int // –ö–æ–ª-–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    Compression bool  // –°–∂–∞—Ç–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ (LZ4)
    MaxBatchSize int // –ú–∞–∫—Å —Ä–∞–∑–º–µ—Ä batch –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    
    // –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
    ReplicationFactor int // –°–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—å (1, 2, 3...)
}
```

**ClickHouse vs MySQL**:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | MySQL | ClickHouse |
|----------|-------|-----------|
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö | –ú–∞–ª—ã–π-—Å—Ä–µ–¥–Ω–∏–π | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π (terabytes) |
| –ó–∞–ø—Ä–æ—Å—ã | UPDATE, DELETE | –¢–æ–ª—å–∫–æ INSERT –∏ SELECT |
| –°–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ | –ú–µ–¥–ª–µ–Ω–Ω–∞—è | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è |
| –†–µ–ø–ª–∏–∫–∞—Ü–∏—è | –°–ª–æ–∂–Ω–∞—è | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è |

**–ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**:

```yaml
# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ª–æ–∫–∞–ª—å–Ω—ã–π ClickHouse)
clickhouse:
    host: localhost
    port: 8123
    username: default
    password: ""
    compression: false
    replication_factor: 1

# –î–ª—è production (–æ–±–ª–∞—á–Ω—ã–π ClickHouse)
clickhouse:
    host: clickhouse-prod.company.com
    port: 8123
    username: crypto_service
    password: very_secure_password
    use_tls: true
    tls_skip_verify: false
    compression: true           # –°–∂–∏–º–∞–µ–º —Ç—Ä–∞—Ñ–∏–∫
    max_batch_size: 50000       # –ë–æ–ª—å—à–∏–µ batches
    replication_factor: 2       # –î—É–±–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)

```yaml
role: monitor

monitor:
    orderbook_depth: 50
    batch_size: 1000
    batch_interval: 3
    ring_buffer_size: 30000
    save_interval: 5

clickhouse:
    host: clickhouse-prod.company.com
    port: 8123
    username: monitor_user
    password: pass
    compression: true
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. –î–µ–º–æ–Ω –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Binance, Bybit –∏ –¥—Ä—É–≥–∏–º –±–∏—Ä–∂–∞–º
2. –ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–∏–≥–∏ –æ—Ä–¥–µ—Ä–æ–≤ –ø–æ WebSocket
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ ClickHouse
4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–æ–≥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ ClickHouse
5. –ù–µ—Ç –Ω–∏–∫–∞–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏, —Ç–æ–ª—å–∫–æ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–æ–ª—å–∫–æ —Ç–æ—Ä–≥–æ–≤–ª—è (–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π)

```yaml
role: trader

trader:
    max_open_orders: 10
    max_position_size: 1000.0
    default_strategy: grid
    strategy_update_interval: 10
    enable_backtest: false

# monitor –∫–æ–Ω—Ñ–∏–≥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. –î–µ–º–æ–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
3. –°–æ–∑–¥–∞–µ—Ç –∏ –æ—Ç–º–µ–Ω—è–µ—Ç –æ—Ä–¥–µ—Ä–∞
4. –£–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∏—Å–∫–∞–º–∏ (–º–∞–∫—Å –æ—Ä–¥–µ—Ä–æ–≤, –º–∞–∫—Å –ø–æ–∑–∏—Ü–∏—è)
5. –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–¥–µ–ª–∫–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±–∞ —Ä–µ–∂–∏–º–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (monitoring + trading)

```yaml
role: both

monitor:
    orderbook_depth: 20
    batch_size: 500
    batch_interval: 5
    ring_buffer_size: 10000
    save_interval: 5

trader:
    max_open_orders: 5
    max_position_size: 500.0
    default_strategy: dca
    strategy_update_interval: 20
    enable_backtest: false

clickhouse:
    host: clickhouse-prod.company.com
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
1. Monitor –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ClickHouse
2. Trader –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ —Ç–æ—Ä–≥—É–µ—Ç
3. –û–±–µ —á–∞—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
4. Trader –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ Monitor –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

---

## üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```go
cfg, err := config.Load("conf/config.yaml")

// –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å:
switch cfg.Role {
case "monitor":
    // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ Monitor
    monitor.Start(cfg.Monitor)
case "trader":
    // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ Trader
    trader.Start(cfg.Trader)
case "both":
    // –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    monitor.Start(cfg.Monitor)
    trader.Start(cfg.Trader)
}
```

---

## üìä –î–∞–Ω–Ω—ã–µ –≤ ClickHouse

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—Å—Ç Monitor:

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–Ω–∏–≥–∏ –æ—Ä–¥–µ—Ä–æ–≤
CREATE TABLE orderbook (
    timestamp UInt64,          -- –ú–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã
    exchange String,           -- "binance", "bybit" –∏ —Ç.–¥.
    pair String,              -- "BTC/USDT"
    market_type String,       -- "spot" –∏–ª–∏ "futures"
    bids Array(Tuple(price Float64, amount Float64)),  -- –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏
    asks Array(Tuple(price Float64, amount Float64)),  -- –ü—Ä–æ–¥–∞–≤—Ü—ã
    depth UInt32,             -- 20, 50 –∏–ª–∏ 0
    seq_num UInt64            -- –ù–æ–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
)
ENGINE = ReplicatedMergeTree()
ORDER BY (timestamp, exchange, pair);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
CREATE TABLE trades (
    timestamp UInt64,
    exchange String,
    pair String,
    price Float64,
    amount Float64,
    side String,              -- "buy" –∏–ª–∏ "sell"
    trade_id String           -- ID —Å–¥–µ–ª–∫–∏ –Ω–∞ –±–∏—Ä–∂–µ
)
ENGINE = ReplicatedMergeTree()
ORDER BY (timestamp, exchange, pair);
```

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- ‚úÖ Config —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ (Role, Monitor, Trader, ClickHouse)
- ‚úÖ –§—É–Ω–∫—Ü–∏—è Load() –ø–∞—Ä—Å–∏—Ç –≤—Å–µ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ YAML
- ‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–∞–∂–¥–æ–º –ø–æ–ª–µ
- ‚úÖ –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (config.example.yaml)
- ‚úÖ –í—Å–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª–æ—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: Phase 1.4

**Phase 1.4 - –°–æ–∑–¥–∞–Ω–∏–µ SQL —Å—Ö–µ–º—ã**:
- [ ] MONITORING —Ç–∞–±–ª–∏—Ü–∞ (—Å–ø–∏—Å–æ–∫ –ø–∞—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
- [ ] TRADE —Ç–∞–±–ª–∏—Ü–∞ (—Å–ø–∏—Å–æ–∫ –ø–∞—Ä –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏)
- [ ] TRADE_HISTORY —Ç–∞–±–ª–∏—Ü–∞ (–∏—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤)
- [ ] DAEMON_STATE —Ç–∞–±–ª–∏—Ü–∞ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ–º–æ–Ω–∞)

**Phase 1.5 - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Exchange Driver**:
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö exchange –¥—Ä–∞–π–≤–µ—Ä–æ–≤
- [ ] –ú–µ—Ç–æ–¥—ã: Connect, Disconnect, GetOrderBook, PlaceOrder, CancelOrder
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

---

## üìö –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

1. **Configuration-driven development** - –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥–æ–º, –Ω–µ –∫–æ–¥–æ–º
2. **Role-based architecture** - –æ–¥–∏–Ω –¥–µ–º–æ–Ω –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏
3. **Batch processing** - —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ batch –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
4. **Ring buffer** - –∫—ç—à –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î
5. **Risk management** - –∫–æ–Ω—Ç—Ä–æ–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–π
6. **Exponential backoff** - —É–º–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
7. **Time-series database** - ClickHouse –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

