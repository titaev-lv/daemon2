# ctdaemon - Полная конфигурация приложения
# Используется формат INI для удобства чтения и редактирования
# Все параметры имеют значения по умолчанию если не указаны

# ============================================================================
# DATABASE - подключение к MySQL/PostgreSQL
# ============================================================================
[database]

# Тип базы данных: mysql или postgres
# Используется для выбора нужного драйвера подключения
type = mysql

# Адрес хоста с БД
# Может быть IP адрес (например 192.168.1.100) или имя хоста (mysql-prod.titaev.pro)
host = localhost

# Порт подключения
# MySQL по умолчанию 3306
# PostgreSQL по умолчанию 5432
port = 3306

# Имя пользователя для подключения
user = db_user

# Пароль для подключения
password = db_pass

# Название базы данных которую используем
name = ct_system

# Использовать ли TLS/SSL шифрование для подключения
# true = шифрованное соединение (безопасно)
# false = незащищенное соединение (опасно для production!)
use_tls = false

# Путь к сертификату CA (Certificate Authority)
# Используется для проверки сертификата сервера БД
# ca_cert = /path/to/ca.crt

# Путь к сертификату клиента
# Используется для взаимной аутентификации (если требуется)
# client_cert = /path/to/client.crt

# Путь к приватному ключу клиента
# client_key = /path/to/client.key

# Пропустить проверку сертификата
# ВНИМАНИЕ: НЕБЕЗОПАСНО! Используется только для разработки с IP адресами
# true = не проверяем сертификат (уязвимо для MITM атак)
# false = проверяем сертификат (безопасно)
# tls_skip_verify = false

# Таймаут подключения в секундах
# Если подключение не установится за это время - попробуем снова
connect_timeout_sec = 10

# КРИТИЧНЫЙ параметр! Максимальное количество попыток подключения при ошибке
# БЕЗ ЭТОГО ПАРАМЕТРА ДЕМОН ПАДАЕТ ПРИ ПЕРВОЙ ОШИБКЕ БД!
# Рекомендуется минимум 5, оптимально 10-20
# С retry логикой демон может выдержать:
#  - временные сбои сети
#  - перезагрузки БД
#  - обслуживание БД с минимальным перерывом
max_retries = 5

# ============================================================================
# SERVER - REST API сервер
# ============================================================================
[server]

# Порт на котором слушает HTTP API сервер
# Используется для управления демоном: запуск, остановка, статус
port = 8080

# Путь к файлу сохранения состояния демона
# Когда демон стартует - проверяет этот файл и восстанавливает состояние
state_file = state/daemon.state

# ============================================================================
# LOG - система логирования
# ============================================================================
[log]

# Уровень логирования: debug, info, warn, error
# debug = все детали (очень много текста, только для разработки)
# info = основные события (рекомендуется для production)
# warn = только важные предупреждения и ошибки
# error = только критичные ошибки
level = debug

# Папка где хранятся логи
# Если папки нет - она будет создана автоматически
dir = ./logs

# Максимальный размер одного лог файла в мегабайтах
# Когда файл достигает этого размера - происходит ротация
# Старый файл переименовывается в backup.20231211_150405.log
max_file_size_mb = 100

# ============================================================================
# ROLE - роль демона (новое в Phase 1.3)
# ============================================================================
[role]

# Режим работы демона:
# monitor = только мониторинг (сбор данных с бирж в ClickHouse)
# trader = только торговля (исполнение стратегий)
# both = и мониторинг и торговля одновременно
mode = both

# ============================================================================
# MONITOR - конфигурация мониторинга (новое в Phase 1.3)
# ============================================================================
[monitor]

# Глубина книги ордеров которую мониторить
# 20 = 20 best bids + 20 best asks (быстро, мало памяти)
# 50 = 50 best bids + 50 best asks (средний вариант)
# 0 = полная книга ордеров (медленно, много памяти)
orderbook_depth = 20

# Размер batch для отправки в ClickHouse
# Собираем N обновлений потом отправляем в БД одним запросом
# Больше = меньше запросов к БД но больше памяти
batch_size = 500

# Интервал между отправками batch в БД (в секундах)
# Даже если не собрали полный batch, отправим через это время
batch_interval_sec = 5

# Размер ring buffer для хранения последних обновлений в памяти
# Ring buffer позволяет быстро получать последние данные без запроса к БД
# Больше = больше памяти но быстрее доступ
ring_buffer_size = 10000

# Интервал сохранения данных в ClickHouse (в секундах)
save_interval = 5

# ============================================================================
# TRADER - конфигурация торговли (новое в Phase 1.3)
# ============================================================================
[trader]

# Максимальное количество открытых ордеров одновременно
# Предотвращает избыточное накопление ордеров при сбое стратегии
max_open_orders = 10

# Максимальный размер позиции в USDT
# Ограничивает риск одной сделки
max_position_size = 1000.0

# Стратегия по умолчанию для новых пар
# Возможные значения: grid, dca, scalp (могут быть расширены)
default_strategy = grid

# Интервал обновления стратегии в секундах
# Как часто Trader переоценивает стратегию и подстраивает параметры
strategy_update_interval = 10

# Допустимое проскальзывание в процентах
# Если ордер исполнится хуже на больший процент - отменяется и переставляется
slippage_percent = 0.5

# Включить режим бэктестирования (тестирование без реального исполнения)
# true = ордера не исполняются, только симулируются (для тестирования)
# false = ордера исполняются реально (production)
enable_backtest = false

# ============================================================================
# TRADE - параметры торговых операций (общие)
# ============================================================================
[trade]

# Интервал обновления статуса торговых позиций в секундах
update_interval = 5

# ============================================================================
# ORDERBOOK - отладка книги ордеров
# ============================================================================
[orderbook]

# Логировать ли сырые сообщения от бирж
# ВНИМАНИЕ: Включение создает ОГРОМНОЕ количество логов!
# true = логировать все сырые сообщения (только для разработки)
# false = не логировать (рекомендуется для production)
debug_log_raw = false

# Логировать ли обработанные сообщения
# ВНИМАНИЕ: Также создает очень много логов!
# true = логировать все обработанные сообщения
# false = не логировать (рекомендуется для production)
debug_log_msg = false

# ============================================================================
# CLICKHOUSE - подключение к ClickHouse (новое в Phase 1.3)
# ============================================================================
[clickhouse]

# Адрес хоста ClickHouse
# ClickHouse используется для хранения больших объемов исторических данных
host = localhost

# Порт HTTP API ClickHouse (обычно 8123)
# ClickHouse имеет несколько портов:
# 8123 = HTTP API (что мы используем)
# 9000 = Native protocol (более быстрый но сложнее)
port = 8123

# Название базы данных в ClickHouse
# ClickHouse отличается от MySQL тем что оптимизирована для аналитики
database = crypto

# Имя пользователя для подключения к ClickHouse
username = default

# Пароль для подключения
password = default

# Использовать ли HTTPS для подключения
use_tls = false

# Пропустить проверку сертификата
# ВНИМАНИЕ: НЕБЕЗОПАСНО! Только для разработки
# tls_skip_verify = false

# Таймаут подключения в секундах
connect_timeout_sec = 10

# Максимальное количество попыток подключения при ошибке
max_retries = 3

# Включить ли сжатие данных при отправке
# true = использовать LZ4 сжатие (значительно снижает трафик)
# false = без сжатия (быстрее но больше трафика)
compression = true

# Максимальный размер batch для отправки данных в ClickHouse
# ClickHouse эффективнее работает с большими batch
# Но нужно помнить о памяти
max_batch_size = 10000

# Фактор репликации данных в ClickHouse
# 1 = без репликации (быстро но рискованно - данные могут потеряться)
# 2 = с репликацией на 2 узла (безопасно и надежно)
# 3+ = с большей репликацией (очень надежно но медленнее)
replication_factor = 1